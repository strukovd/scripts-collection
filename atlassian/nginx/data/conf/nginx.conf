events {
  worker_connections  2048;  ## Default: 1024
}

http {

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    client_max_body_size 1024m;
    #default_type application/octet-stream;
    gzip on;
    gzip_disable "msie6";

    upstream crowd {
        server crowd:8095;
    }

    upstream bitbucket {
        server bitbucket:7990;
    }

    upstream jira-software {
        server jira-software:8080;
    }

    upstream jira-sd {
            server jira-sd:8080;
    }

    upstream confluence {
                server confluence:8090;
    }

    upstream confluence-synchrony {
                    server confluence:8091;
    }

    server {
      server_name crowd.bank.local;
      listen 443 ssl;
      ssl_certificate /etc/nginx/cert.crt;
      ssl_certificate_key /etc/nginx/cert.key;

      ssl_session_timeout 1d;
      ssl_session_cache shared:SSL:50m;
      ssl_session_tickets off;

      access_log  /var/log/nginx/access.log;
      error_log /var/log/nginx/error.log warn;

      client_max_body_size 0;
      chunked_transfer_encoding on;

      location / {
        proxy_pass http://crowd;
        proxy_set_header  Host $http_host;   # required for docker client's sake
        proxy_set_header  X-Real-IP $remote_addr; # pass on real client's IP
        proxy_set_header  X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header  X-Forwarded-Proto $scheme;
        proxy_read_timeout                  900;
      }
   }

   server {
          server_name bb.bank.local;
          listen 443 ssl;
          ssl_certificate /etc/nginx/cert.crt;
          ssl_certificate_key /etc/nginx/cert.key;

          ssl_session_timeout 1d;
          ssl_session_cache shared:SSL:50m;
          ssl_session_tickets off;

          access_log  /var/log/nginx/access.log;
          error_log /var/log/nginx/error.log warn;

          client_max_body_size 0;
          chunked_transfer_encoding on;

          location / {
            proxy_pass http://bitbucket;
            proxy_set_header  Host $http_host;   # required for docker client's sake
            proxy_set_header  X-Real-IP $remote_addr; # pass on real client's IP
            proxy_set_header  X-Forwarded-For   $proxy_add_x_forwarded_for;
            proxy_set_header  X-Forwarded-Proto $scheme;
            proxy_read_timeout                  900;
          }
   }


   server {
         server_name tasks.bank.local;
         listen 443 ssl;
         ssl_certificate /etc/nginx/cert.crt;
         ssl_certificate_key /etc/nginx/cert.key;

         ssl_session_timeout 1d;
         ssl_session_cache shared:SSL:50m;
         ssl_session_tickets off;

         access_log  /var/log/nginx/access_js.log;
         error_log /var/log/nginx/error_js.log warn;

         client_max_body_size 0;
         chunked_transfer_encoding on;
         location / {
           proxy_pass http://jira-software;
           proxy_set_header  Host $http_host;   # required for docker client's sake
           proxy_set_header  X-Real-IP $remote_addr; # pass on real client's IP
           proxy_set_header  X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header  X-Forwarded-Proto $scheme;
           proxy_read_timeout                  900;
         }
   }




   server {
     server_name sd.bank.local;
     listen 443 ssl;
     ssl_certificate /etc/nginx/cert.crt;
     ssl_certificate_key /etc/nginx/cert.key;

     ssl_session_timeout 1d;
     ssl_session_cache shared:SSL:50m;
     ssl_session_tickets off;

     access_log  /var/log/nginx/access_js.log;
     error_log /var/log/nginx/error_js.log warn;

     client_max_body_size 0;
     chunked_transfer_encoding on;
     location / {
       proxy_pass http://jira-sd;
       proxy_set_header  Host $http_host;   # required for docker client's sake
       proxy_set_header  X-Real-IP $remote_addr; # pass on real client's IP
       proxy_set_header  X-Forwarded-For   $proxy_add_x_forwarded_for;
       proxy_set_header  X-Forwarded-Proto $scheme;
       proxy_read_timeout                  900;
     }
   }


   server {
     server_name wiki.bank.local;
     listen 443 ssl;
     ssl_certificate /etc/nginx/cert.crt;
     ssl_certificate_key /etc/nginx/cert.key;

     ssl_session_timeout 1d;
     ssl_session_cache shared:SSL:50m;
     ssl_session_tickets off;

     access_log  /var/log/nginx/access_js.log;
     error_log /var/log/nginx/error_js.log warn;

     client_max_body_size 100m;
     chunked_transfer_encoding on;

     location / {
       proxy_pass http://confluence;
       proxy_set_header  Host $http_host;   # required for docker client's sake
       proxy_set_header  X-Real-IP $remote_addr; # pass on real client's IP
       proxy_set_header  X-Forwarded-For   $proxy_add_x_forwarded_for;
       proxy_set_header  X-Forwarded-Proto $scheme;
       proxy_read_timeout                  900;
     }

     location /synchrony {
       proxy_set_header X-Forwarded-Host $host;
       proxy_set_header X-Forwarded-Server $host;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_pass http://confluence-synchrony/synchrony;
       proxy_http_version 1.1;
       proxy_set_header Upgrade $http_upgrade;
       proxy_set_header Connection "Upgrade";
     }
  }


   server {
     listen 80 default_server;
     return 301 https://$host$request_uri;
   }
}